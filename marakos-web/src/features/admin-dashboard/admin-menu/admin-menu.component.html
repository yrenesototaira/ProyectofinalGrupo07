<div>
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-slate-100">Gestionar Carta (Menú)</h1>
    <a routerLink="/admin/menu/new" class="px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-500 text-sm font-medium transition-colors">
      Crear Carta
    </a>
  </div>

  <div class="bg-slate-900/50 p-6 rounded-lg mb-6">
    <form [formGroup]="filterForm" (ngSubmit)="onFilterSubmit()" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
      <div>
        <label for="name" class="block text-sm font-medium text-slate-300 mb-1">Nombre</label>
        <input id="name" type="text" formControlName="name" class="w-full bg-slate-800 border border-slate-700 rounded-md px-3 py-2 text-white placeholder-slate-400 focus:ring-emerald-500 focus:border-emerald-500">
      </div>
      <div>
        <label for="categoryId" class="block text-sm font-medium text-slate-300 mb-1">Categoría</label>
        <select id="categoryId" formControlName="categoryId" class="w-full bg-slate-800 border border-slate-700 rounded-md px-3 py-2 text-white focus:ring-emerald-500 focus:border-emerald-500">
          <option value="">Todas</option>
          @for (category of categories(); track category.id) {
            <option [value]="category.id">{{ category.name }}</option>
          }
        </select>
      </div>
      <div>
        <label for="active" class="block text-sm font-medium text-slate-300 mb-1">Estado</label>
        <select id="active" formControlName="active" class="w-full bg-slate-800 border border-slate-700 rounded-md px-3 py-2 text-white focus:ring-emerald-500 focus:border-emerald-500">
          <option [ngValue]="null">Todos</option>
          <option [ngValue]="true">Activo</option>
          <option [ngValue]="false">Inactivo</option>
        </select>
      </div>
      <div class="flex gap-2">
        <button type="submit" class="w-full px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-500 text-sm font-medium transition-colors">Filtrar</button>
        <button type="button" (click)="resetFilters()" class="w-full px-4 py-2 bg-slate-600 text-white rounded-md hover:bg-slate-500 text-sm font-medium transition-colors">Limpiar</button>
      </div>
    </form>
  </div>

  <div class="bg-slate-900/50 rounded-lg overflow-x-auto">
    <table class="min-w-full text-left text-sm whitespace-nowrap">
      <thead class="tracking-wider border-b border-slate-700">
        <tr>
          <th scope="col" class="px-6 py-3">Imagen</th>
          <th scope="col" class="px-6 py-3">Categoría</th>
          <th scope="col" class="px-6 py-3">Nombre</th>
          <th scope="col" class="px-6 py-3">Descripción</th>
          <th scope="col" class="px-6 py-3">Precio</th>
          <th scope="col" class="px-6 py-3">Estado</th>
          <th scope="col" class="px-6 py-3 text-right">Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (item of products(); track item.id) {
          <tr class="border-b border-slate-700/50 hover:bg-slate-800/40 transition-colors">
            <td class="px-6 py-4">
              @if (item.pictureUrl) {
                <img [src]="item.pictureUrl" [alt]="item.name" class="h-12 w-12 object-cover rounded-md">
              } @else {
                <div class="h-12 w-12 bg-slate-700 rounded-md flex items-center justify-center text-xs text-slate-400">Sin foto</div>
              }
            </td>
            <td class="px-6 py-4 text-slate-400">{{ item.category?.name }}</td>
            <td class="px-6 py-4 font-medium text-slate-200">{{ item.name }}</td>
            <td class="px-6 py-4 text-slate-400 truncate max-w-xs">{{ item.description }}</td>
            <td class="px-6 py-4 font-mono text-amber-400">{{ item.price | currency:'S/ ' }}</td>
            <td class="px-6 py-4">
              @if (item.active) {
                <span class="px-2 py-1 text-xs font-semibold text-green-100 bg-green-600/50 rounded-full">Activo</span>
              } @else {
                <span class="px-2 py-1 text-xs font-semibold text-red-100 bg-red-600/50 rounded-full">Inactivo</span>
              }
            </td>
            <td class="px-6 py-4 text-right">
              <div class="flex justify-end gap-2">
                <a [routerLink]="['/admin/menu/edit', item.id]" class="px-3 py-1 bg-amber-600 text-white rounded-md hover:bg-amber-700 text-xs font-medium transition-colors">
                  Editar
                </a>
                <button (click)="requestDeletion(item)" class="px-3 py-1 bg-rose-600 text-white rounded-md hover:bg-rose-700 text-xs font-medium transition-colors">
                  Eliminar
                </button>
              </div>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="7" class="text-center text-slate-400 py-8">
              No se encontraron productos con los filtros actuales.
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>

<app-confirmation-modal
  [isOpen]="isDeleteModalOpen()"
  title="Confirmar Eliminación"
  [message]="'¿Estás seguro de que quieres eliminar el producto ' + (itemToDelete()?.name || '') + '? Esta acción es permanente.'"
  confirmButtonText="Sí, Eliminar Producto"
  (confirm)="confirmDeletion()"
  (close)="closeDeleteModal()">
</app-confirmation-modal>